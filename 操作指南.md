# 自動交易系統操作指南

## 🚀 快速開始

### 1. 啟動系統
```bash
# 方法1: 直接啟動 API 伺服器
python -m uvicorn src.api.main:app --reload --host 0.0.0.0 --port 8000

# 方法2: 使用啟動器選擇介面
python start_system.py
```

### 2. 選擇操作方式

#### 🌐 Web API 圖形化介面 (最推薦)
- 網址：`http://localhost:8000/docs`
- **優點**：
  - ✅ 完全圖形化，點擊操作
  - ✅ 所有參數都有下拉選單
  - ✅ 即時查看結果
  - ✅ 無需記憶指令

#### 📊 K線圖查看器 (真正的TradingView!)
```bash
python chart_viewer.py
```
- **優點**：
  - 🚀 **使用真正的TradingView圖表引擎**
  - ⭐ 專業級商業圖表品質
  - ✅ 即時數據自動更新
  - ✅ 完整的技術分析工具
  - ✅ 深色/淺色主題切換
  - ✅ 結合我們的AI分析結果
  - ✅ 無技術錯誤的穩定系統

#### 💻 命令行互動介面
```bash
python interactive_trading.py
```
- **優點**：
  - ✅ 選單式操作
  - ✅ 數字選擇，無需輸入複雜參數
  - ✅ 逐步引導

#### 📊 快速示範
```bash
python quick_demo.py
```

### 🎯 定制TradingView圖表 (最新功能)
```bash
python demo_custom_chart.py
```
**功能特色**：
- ✅ **專為你需求設計**：只顯示K線、成交量、RSI
- 🤖 **AI買賣區間建議**：智能分析買入和賣出價格區間
- 📊 **實時股票數據**：當前價格、漲跌幅、成交量、RSI
- ⚙️ **策略資訊顯示**：使用的交易策略及參數
- 🎨 **專業界面設計**：響應式布局，支援深色/淺色主題
- 🔄 **自動數據刷新**：每5分鐘自動更新市場數據

**直接訪問範例**：
- AAPL定制圖表：`http://localhost:8000/chart/custom/AAPL`
- 台積電定制圖表：`http://localhost:8000/chart/custom/2330.TW`
- 淺色主題：`http://localhost:8000/chart/custom/AAPL?theme=light`
- 不含AI建議：`http://localhost:8000/chart/custom/AAPL?include_ai=false`

## 🎯 主要功能使用

### 📊 K線圖查看 (真正的TradingView圖表!)
**圖形界面操作**：
1. 執行 `python chart_viewer.py`
2. 選擇股票代號（下拉選單包含常用股票）
3. 選擇圖表類型：**TradingView (強烈推薦)**、Professional、Plotly、mplfinance
4. 選擇主題：深色/淺色
5. 點擊「生成K線圖」

**直接網址訪問**：
- **🚀 定制TradingView圖表** (最新推薦)：`http://localhost:8000/chart/custom/AAPL`
- **🚀 TradingView圖表** (強烈推薦)：`http://localhost:8000/chart/tradingview/AAPL`
- TradingView高級圖表：`http://localhost:8000/chart/tradingview/AAPL?chart_type=advanced`
- TradingView迷你圖表：`http://localhost:8000/chart/tradingview/AAPL?chart_type=mini`
- 專業圖表：`http://localhost:8000/chart/professional/AAPL`
- 策略績效圖：`http://localhost:8000/chart/performance/AAPL`

**🚀 真正的TradingView功能**：
- ⭐ **真實TradingView引擎**：使用官方TradingView圖表組件
- 📊 **即時數據**：自動更新的真實市場數據
- 🛠️ **完整分析工具**：所有TradingView內建的技術分析工具
- 🎨 **專業界面**：與TradingView網站完全一致的使用體驗
- 🧠 **AI分析整合**：在側邊欄顯示我們的形態分析結果
- 🤖 **AI聊天室**：實時策略討論和交易建議
- 💰 **詳細交易計劃**：清楚的買入點、目標價、停損點
- ⚖️ **風險報酬分析**：完整的風險管理資訊
- 🔄 **無技術錯誤**：穩定可靠，無Plotly兼容性問題
- ⚡ **高效能**：TradingView級別的圖表渲染性能
- 📱 **響應式設計**：支援桌面和移動設備

**🎯 詳細形態分析標示**：
- 💰 **現價**：當前市場價格
- 🔵 **買入點**：建議的進場價位
- 🎯 **目標價**：獲利了結價位 (含獲利百分比)
- 🛑 **停損點**：風險控制價位
- ⚖️ **風險報酬比**：投資價值評估 (1:X格式)
- 📅 **形成期間**：形態發展的完整時間軸
- 💡 **交易計劃**：基於形態的具體操作建議

**🤖 AI聊天室功能**：
- 💬 **即時對話**：與AI討論任何交易策略問題
- 🎯 **快速問題**：預設常用問題按鈕
- 📊 **技術分析解讀**：深入解釋圖表形態
- 🔄 **回測建議**：策略優化建議
- ⚠️ **風險評估**：專業的風險管理建議
- 📈 **趨勢分析**：市場走勢判斷

### 📊 形態分析
**網頁操作**：
1. 打開 `http://localhost:8000/docs`
2. 找到 `POST /patterns/advanced/{symbol}`
3. 點擊「Try it out」
4. 在 `symbol` 欄位選擇或輸入股票代號（如 AAPL）
5. 在 `period` 下拉選單選擇分析期間（1mo/3mo/6mo）
6. 點擊「Execute」查看結果

**支援的形態**：
- 🏴 旗型 (Flags)
- 🔺 三角旗 (Pennants) 
- 📐 楔型 (Wedges)
- 🔻 三角形 (Triangles)
- 📏 通道 (Channels)
- ☕ 杯柄 (Cup & Handle)

### 🤖 AI 策略討論
**網頁操作**：
1. 找到 `POST /ai/discuss-strategy`
2. 點擊「Try it out」
3. 填寫參數：
   - `symbol`: 股票代號
   - `period`: 分析期間
   - `user_question`: 您的問題
   - `include_patterns`: 是否包含形態分析
4. 點擊「Execute」

**常用問題範例**：
- "基於當前市況，建議使用什麼策略？"
- "這檔股票適合長期投資嗎？"
- "目前的技術指標顯示什麼訊號？"
- "風險評估和建議停損點？"

### 📈 策略回測
**網頁操作**：
1. 找到 `POST /backtest`
2. 點擊「Try it out」
3. 設定參數：
   - `symbol`: 股票代號
   - `start_date`: 開始日期 (YYYY-MM-DD)
   - `end_date`: 結束日期 (YYYY-MM-DD)
   - `strategy_name`: 策略名稱
   - `initial_capital`: 初始資金
4. 點擊「Execute」

**可用策略**：
- `rsi_macd`: RSI + MACD 策略
- `ma_crossover`: 均線交叉策略
- `pattern_trading`: 形態交易策略 ⭐
- `enhanced_pattern`: 增強形態策略

### ⚖️ 查看可用策略
**網頁操作**：
1. 找到 `GET /backtest/strategies`
2. 點擊「Try it out」
3. 點擊「Execute」
4. 查看所有策略和詳細說明

## 📱 常用股票代號

### 美股
- **科技股**：AAPL, GOOGL, MSFT, AMZN, TSLA, META, NVDA
- **指數 ETF**：SPY (S&P 500), QQQ (NASDAQ), IWM (小型股)
- **其他**：NFLX, BABA, AMD, GLD (黃金), TLT (債券)

### 台股
- 格式：股票代號.TW (如 2330.TW)
- 主要股票：2330.TW (台積電), 2317.TW (鴻海)

## 🛠️ 進階設定

### OpenAI API Key 設定 (啟用 AI 功能)
1. 在專案根目錄創建 `.env` 檔案
2. 添加：`OPENAI_API_KEY=your_api_key_here`
3. 重啟系統

### 策略參數調整
在回測時可以自訂策略參數：

```json
{
  "strategy_params": {
    "pattern_confidence_threshold": 0.6,
    "risk_reward_ratio": 2.0,
    "enable_flags": true,
    "enable_wedges": true,
    "enable_triangles": true
  }
}
```

## 🔧 常見問題

### Q: 如何選擇參數而不用手動輸入？
A: 使用 Web API 介面 (`http://localhost:8000/docs`)，大部分參數都有預設值或下拉選單。

### Q: 為什麼 AI 功能回應 503 錯誤？
A: 需要設定 OpenAI API Key。AI 功能為可選功能，不影響其他操作。

### Q: 回測結果如何解讀？
A: 重點指標：
- **總報酬率**：整體獲利百分比
- **夏普比率**：風險調整後報酬（>1 較好）
- **最大回撤**：最大虧損幅度
- **勝率**：獲利交易比例

### Q: 哪個策略比較好？
A: 建議使用 `pattern_trading`（形態交易策略），這是新開發的策略，整合了：
- 多種圖表形態識別
- 信心度評分
- 風險報酬比篩選

## 📞 技術支援

如有問題，請檢查：
1. API 伺服器是否運行 (`http://localhost:8000/health`)
2. 股票代號格式是否正確
3. 日期格式是否為 YYYY-MM-DD
4. 網路連接是否正常

**推薦操作流程**：
1. 使用 Web API 介面最簡單
2. 先查看可用策略
3. 分析股票形態
4. 執行策略回測
5. 比較不同策略表現