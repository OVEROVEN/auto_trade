# 核心API服務 - 精簡版Dockerfile
FROM python:3.11-slim

WORKDIR /app

# 只安裝核心依賴
COPY requirements-core.txt .
RUN pip install --no-cache-dir -r requirements-core.txt

# 複製所有源代碼 (排除不必要的文件由.dockerignore處理)
COPY src/ ./src/
COPY config/ ./config/

# 創建必要目錄
RUN mkdir -p data logs

# 設置Python路徑
ENV PYTHONPATH=/app

# 使用Railway的動態端口
EXPOSE $PORT

# 啟動核心服務 - 使用Railway的PORT環境變量
CMD ["sh", "-c", "python -m uvicorn src.api.main_core:app --host 0.0.0.0 --port ${PORT:-8000}"]